# Справочник таблиц БД (проект TEC Demo)

> Источник: локальный код проекта и файлы `/Users/air/Desktop/tec_demo/docs/schedule-schema.md`, `/Users/air/Desktop/tec_demo/docs/journals-schema.md`.
> Прямой экспорт из Supabase недоступен в текущей среде (DNS `ENOTFOUND`), поэтому часть полей помечена как **предполагаемая**.

## Условные обозначения
- **Подтверждено**: поле явно используется в коде или есть в локальном DDL.
- **Предполагаемое**: поле не описано DDL, но видно по `select *`/UI.

## 1) `profiles`
Назначение: профиль пользователя Supabase Auth и привязка к сотруднику.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `uuid` | ID пользователя (обычно `auth.users.id`) | Подтверждено |
| `employee_id` | `int` | Ссылка на `employees.id` | Подтверждено |
| `updated_at` | `timestamptz` | Время обновления привязки | Подтверждено |

## 2) `employees`
Назначение: карточка сотрудника.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `int` | ID сотрудника | Подтверждено |
| `first_name` | `text` | Имя | Подтверждено |
| `last_name` | `text` | Фамилия | Подтверждено |
| `middle_name` | `text` | Отчество | Подтверждено |
| `position_id` | `int` | Ссылка на `positions.id` | Подтверждено |
| `birth_date` | `date` | Дата рождения | Подтверждено |
| `phone` | `text` | Телефон | Подтверждено |
| `union_member` | `boolean` | Член профсоюза | Подтверждено |
| `auth_user_id` | `uuid` | Привязка к auth-пользователю | Предполагаемое (README) |

## 3) `positions`
Назначение: справочник должностей/подразделений.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `int` | ID должности | Подтверждено |
| `name` | `text` | Название должности | Подтверждено |
| `departament_name` | `text` | Отдел/департамент (орфография в БД: `departament`) | Подтверждено |
| `devision_name` | `text` | Отделение/дивизион (орфография в БД: `devision`) | Подтверждено |
| `type` | `text` | Тип персонала (оперативный/АТП и т.д.) | Подтверждено |
| `sort_weight` | `numeric/int` | Вес для сортировки | Подтверждено |

## 4) `children`
Назначение: дети сотрудника (соц. блок).

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `int` | ID записи | Подтверждено |
| `id_employees` | `int` | Ссылка на `employees.id` | Подтверждено |
| `first_name` | `text` | Имя | Подтверждено |
| `last_name` | `text` | Фамилия | Подтверждено |
| `middle_name` | `text` | Отчество | Подтверждено |
| `birth_date` | `date` | Дата рождения | Подтверждено |

## 5) `journals`
Назначение: справочник журналов (директивы, дефекты, docs и т.д.).

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `serial` | PK журнала | Подтверждено (DDL) |
| `code` | `text unique` | Уникальный код журнала | Подтверждено (DDL) |
| `name` | `text` | Название журнала | Подтверждено (DDL) |
| `description` | `text` | Описание | Подтверждено (DDL) |
| `created_at` | `timestamptz` | Дата создания | Подтверждено (DDL) |

## 6) `entries`
Назначение: записи журналов.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `uuid` | PK записи | Подтверждено (DDL) |
| `journal_id` | `int` | FK на `journals.id` | Подтверждено (DDL) |
| `title` | `text` | Заголовок | Подтверждено (DDL) |
| `body` | `text` | Текст записи | Подтверждено (DDL) |
| `type` | `text` | Категория записи (admin/turbine/boiler/...) | Подтверждено |
| `status` | `text` | Статус (open/...) | Подтверждено (DDL) |
| `unit` | `text` | Подразделение/цех | Подтверждено |
| `created_at` | `timestamptz` | Дата создания | Подтверждено |
| `created_by_profile_id` | `uuid` | Автор-профиль | Подтверждено |
| `created_by_employee_id` | `int` | Автор-сотрудник | Подтверждено |
| `tags` | `jsonb` | Теги | Подтверждено (DDL) |
| `attachments` | `jsonb` | Вложения | Подтверждено (DDL) |
| `author_snapshot` | `jsonb` | Снимок автора (ФИО/должность) | Подтверждено |

## 7) `entry_receipts`
Назначение: отметки «ознакомлен» по записям.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `entry_id` | `uuid` | FK на `entries.id` | Подтверждено (DDL) |
| `profile_id` | `uuid` | FK на `profiles.id` | Подтверждено (DDL) |
| `acknowledged_at` | `timestamptz` | Время ознакомления | Подтверждено (DDL) |

## 8) `entry_reads`
Назначение: «последнее прочтение журнала» по пользователю.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `profile_id` | `uuid` | FK на `profiles.id` | Подтверждено (DDL) |
| `journal_id` | `int` | FK на `journals.id` | Подтверждено (DDL) |
| `last_seen_at` | `timestamptz` | Последний просмотр журнала | Подтверждено (DDL) |

## 9) `shift_templates`
Назначение: шаблоны смен.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `serial` | PK шаблона | Подтверждено (DDL) |
| `code` | `text unique` | Код шаблона | Подтверждено |
| `name` | `text` | Имя шаблона | Подтверждено |
| `start_time` | `time` | Начало смены | Подтверждено |
| `end_time` | `time` | Конец смены | Подтверждено |
| `duration_hours` | `numeric(5,2)` | Длительность в часах | Подтверждено |
| `night` | `boolean` | Признак ночной смены | Подтверждено |
| `is_rotational` | `boolean` | Ротационная смена | Подтверждено |
| `description` | `text` | Описание шаблона | Подтверждено (DDL) |

## 10) `schedule`
Назначение: календарный план смен по сотруднику и дате.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `bigserial` | PK записи | Подтверждено (DDL) |
| `employee_id` | `int` | FK на `employees.id` | Подтверждено |
| `date` | `date` | Дата смены | Подтверждено |
| `template_id` | `int` | FK на `shift_templates.id` | Подтверждено |
| `start_time` | `time` | Время начала | Подтверждено |
| `end_time` | `time` | Время конца | Подтверждено |
| `planned_hours` | `numeric(5,2)` | Плановые часы | Подтверждено |
| `unit` | `text` | Цех/подразделение | Подтверждено |
| `source` | `text` | Источник (`manual/generated/rotation/status/...`) | Подтверждено |
| `note` | `text` | Примечание | Подтверждено |
| `created_at` | `timestamptz` | Когда создано | Подтверждено (DDL) |
| `created_by` | `uuid` | Кто создал | Подтверждено |

Ограничение: `unique (employee_id, date)` (по локальному DDL).

## 11) `schedule_overrides`
Назначение: исключения/корректировки графика (отпуск, больничный, донорский, переработка и т.д.).

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `bigserial` | PK | Подтверждено (DDL) |
| `employee_id` | `int` | FK на `employees.id` | Подтверждено |
| `date` | `date` | Дата корректировки | Подтверждено |
| `kind` | `text` | Тип корректировки | Подтверждено |
| `hours_delta` | `numeric(5,2)` | Изменение часов | Подтверждено |
| `start_time` | `time` | Начало (опц.) | Подтверждено |
| `end_time` | `time` | Конец (опц.) | Подтверждено |
| `comment` | `text` | Комментарий | Подтверждено |
| `doc_ref` | `text` | Ссылка на документ | Подтверждено (DDL) |
| `unit` | `text` | Цех | Подтверждено |
| `created_at` | `timestamptz` | Когда создано | Подтверждено (DDL) |
| `created_by` | `uuid` | Кто создал | Подтверждено (DDL) |

## 12) `rotations`
Назначение: шаблоны ротаций/циклов.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `serial` | PK | Подтверждено (DDL) |
| `name` | `text` | Название | Подтверждено (DDL) |
| `template_id` | `int` | FK на `shift_templates.id` | Подтверждено (DDL) |
| `pattern` | `jsonb` | Паттерн ротации | Подтверждено (DDL) |
| `start_date` | `date` | Старт цикла | Подтверждено (DDL) |
| `timezone` | `text` | Таймзона | Подтверждено (DDL) |
| `unit` | `text` | Цех | Подтверждено (DDL) |
| `description` | `text` | Описание | Подтверждено (DDL) |

## 13) `absence_requests`
Назначение: заявки на отсутствие/освобождение.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `uuid` | PK | Подтверждено (DDL) |
| `employee_id` | `int` | FK на `employees.id` | Подтверждено (DDL) |
| `date_from` | `date` | Начало периода | Подтверждено (DDL) |
| `date_to` | `date` | Конец периода | Подтверждено (DDL) |
| `kind` | `text` | Тип отсутствия | Подтверждено (DDL) |
| `status` | `text` | Статус (`draft/approved/rejected`) | Подтверждено (DDL) |
| `approver_id` | `int` | Согласующий | Подтверждено (DDL) |
| `comment` | `text` | Комментарий | Подтверждено (DDL) |
| `created_at` | `timestamptz` | Когда создано | Подтверждено (DDL) |
| `created_by` | `uuid` | Кто создал | Подтверждено (DDL) |

## 14) `time_balances`
Назначение: агрегированные балансы часов по месяцам.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `employee_id` | `int` | FK на `employees.id` | Подтверждено (DDL) |
| `month` | `date` | Месяц (первое число месяца) | Подтверждено (DDL) |
| `planned_hours` | `numeric(6,2)` | Плановые часы | Подтверждено (DDL) |
| `worked_hours` | `numeric(6,2)` | Фактические часы | Подтверждено (DDL) |
| `overtime_hours` | `numeric(6,2)` | Переработка | Подтверждено (DDL) |
| `debt_hours` | `numeric(6,2)` | Недоработка/долг | Подтверждено (DDL) |
| `updated_at` | `timestamptz` | Обновлено | Подтверждено (DDL) |

PK: `(employee_id, month)`.

## 15) `orders` (legacy)
Назначение: старый вариант журнала (до `journals/entries`).

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `uuid/int` | ID записи | Подтверждено (по коду) |
| `type` | `text` | Тип записи | Подтверждено |
| `title` | `text` | Заголовок | Подтверждено |
| `body` | `text` | Текст | Подтверждено |
| `author_name` | `text` | Автор | Подтверждено |
| `control_point` | `text` | Контрольная точка/пост | Подтверждено |
| `created_at` | `timestamptz` | Дата создания | Подтверждено |

## 16) `equipment`
Назначение: реестр оборудования (карточки на экране оборудования).

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `uuid/int` | ID записи | Подтверждено (по `select *`) |
| `name` | `text` | Название | Предполагаемое |
| `code` | `text` | Код/номер | Предполагаемое |
| `area` | `text` | Зона/участок | Предполагаемое |
| `zone` | `text` | Альтернативное поле зоны | Предполагаемое |
| `status` | `text` | Статус | Предполагаемое |
| `note` | `text` | Краткая заметка | Предполагаемое |
| `description` | `text` | Описание | Предполагаемое |

## 17) `roster`
Назначение: состав смены/дежурной команды.

| Поле | Тип | Описание | Статус |
|---|---|---|---|
| `id` | `uuid/int` | ID записи | Подтверждено (по `select *`) |
| `name` | `text` | ФИО (вариант 1) | Предполагаемое |
| `full_name` | `text` | ФИО (вариант 2) | Предполагаемое |
| `role` | `text` | Роль | Предполагаемое |
| `position` | `text` | Должность | Предполагаемое |
| `status` | `text` | Статус на смене | Предполагаемое |
| `location` | `text` | Локация | Предполагаемое |
| `control_point` | `text` | Контрольная точка/пост | Предполагаемое |

---

## Как быстро сверить с фактической схемой
Когда будет доступ к Supabase из среды:
1. Запустить `node /Users/air/Desktop/tec_demo/export_schema.js`
2. На основе `schema.json` обновить этот файл, особенно для `equipment` и `roster`.

